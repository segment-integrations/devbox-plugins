version: "0.5"

log_location: "${REPORTS_DIR:-reports}/e2e-logs"
log_level: info

environment:
  - "TEST_PURE=1"

processes:
  # Android E2E - runs plugin's test suite with deterministic mode
  e2e-android:
    command: "cd examples/android && devbox run test:e2e"
    working_dir: "."
    availability:
      restart: "no"

  # iOS E2E - runs plugin's test suite (parallel with Android)
  e2e-ios:
    command: "cd examples/ios && devbox run test:e2e"
    working_dir: "."
    availability:
      restart: "no"

  # React Native E2E - waits for both Android and iOS
  e2e-react-native:
    command: "cd examples/react-native && devbox run test:e2e:all"
    working_dir: "."
    depends_on:
      e2e-android:
        condition: process_completed
      e2e-ios:
        condition: process_completed
    availability:
      restart: "no"

  # Summary
  summary:
    command: |
      echo ""
      echo "========================================"
      echo "      E2E TESTS COMPLETE"
      echo "========================================"
      echo ""
      echo "Results:"
      echo "  Check logs above for individual test results"
      echo ""
      echo "Logs: ${REPORTS_DIR:-reports}/e2e-logs"
      echo ""

      # In TUI mode, delay 30 seconds so user can view summary before exit
      if [ "${TEST_TUI:-false}" = "true" ] || [ "${TEST_TUI:-false}" = "1" ]; then
        echo ""
        echo "TUI mode: Waiting 30 seconds before exit (Ctrl+C to exit now)..."
        sleep 30
        echo "Exiting..."
      fi
      exit 0
    depends_on:
      e2e-android:
        condition: process_completed
      e2e-ios:
        condition: process_completed
      e2e-react-native:
        condition: process_completed
    availability:
      restart: "no"
