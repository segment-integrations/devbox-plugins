version: "0.5"

log_location: "${REPORTS_DIR:-reports}/devbox-unit-tests-logs"
log_level: info

processes:
  # Android unit tests (run in parallel)
  test-android-lib:
    command: "bash plugins/tests/android/test-lib.sh"
    availability:
      restart: "no"

  test-android-devices:
    command: "bash plugins/tests/android/test-devices.sh"
    availability:
      restart: "no"

  test-android-device-mgmt:
    command: "bash plugins/tests/android/test-device-mgmt.sh"
    availability:
      restart: "no"

  test-android-validation:
    command: "bash plugins/tests/android/test-validation.sh"
    availability:
      restart: "no"

  # iOS unit tests (run in parallel)
  test-ios-lib:
    command: "sh plugins/tests/ios/test-lib.sh"
    availability:
      restart: "no"

  test-ios-device-mgmt:
    command: "bash plugins/tests/ios/test-device-mgmt.sh"
    availability:
      restart: "no"

  test-ios-validation:
    command: "bash plugins/tests/ios/test-cache.sh"
    availability:
      restart: "no"

  # Summary - runs after all tests complete
  summary:
    command: |
      echo ""
      echo "========================================"
      echo "     UNIT TESTS SUITE SUMMARY"
      echo "========================================"
      echo ""
      echo "Android Tests:"
      echo "  ✓ lib.sh"
      echo "  ✓ devices.sh"
      echo "  ✓ device-mgmt"
      echo "  ✓ validation"
      echo ""
      echo "iOS Tests:"
      echo "  ✓ lib.sh"
      echo "  ✓ device-mgmt"
      echo "  ✓ validation"
      echo ""
      echo "========================================"
      echo "     ALL UNIT TESTS PASSED ✓"
      echo "========================================"
      echo ""

      # In TUI mode, delay 30 seconds so user can view summary before exit
      if [ "${TEST_TUI:-false}" = "true" ] || [ "${TEST_TUI:-false}" = "1" ]; then
        echo ""
        echo "TUI mode: Waiting 30 seconds before exit (Ctrl+C to exit now)..."
        sleep 30
        echo "Exiting..."
      fi
      exit 0
    depends_on:
      test-android-lib:
        condition: process_completed
      test-android-devices:
        condition: process_completed
      test-android-device-mgmt:
        condition: process_completed
      test-android-validation:
        condition: process_completed
      test-ios-lib:
        condition: process_completed
      test-ios-device-mgmt:
        condition: process_completed
      test-ios-validation:
        condition: process_completed
    availability:
      restart: "no"
