{
  "include": ["path:../../plugins/react-native/plugin.json"],
  "packages": [
    "nodejs@20",
    "watchman@latest",
    "jdk17@latest",
    "gradle@latest"
  ],
  "env": {
    "IOS_APP_PROJECT": "ReactNativeExample.xcodeproj",
    "IOS_APP_SCHEME": "ReactNativeExample",
    "IOS_APP_BUNDLE_ID": "org.reactjs.native.example.ReactNativeExample",
    "IOS_APP_ARTIFACT": ".devbox/virtenv/ios/DerivedData/Build/Products/Debug-iphonesimulator/ReactNativeExample.app",
    "ANDROID_APP_ID": "com.reactnativeexample",
    "ANDROID_APP_APK": "android/app/build/outputs/apk/debug/app-debug.apk",
    "ANDROID_MAX_API": "35",
    "DEVBOX_COREPACK_ENABLED": "",
    "ANDROID_SDK_REQUIRED": "0"
  },
  "shell": {
    "scripts": {
      "install": [
        "npm install"
      ],
      "build:node": [
        "npm install"
      ],
      "build:android": [
        "devbox run install",
        "cd android && gradle assembleDebug"
      ],
      "build:ios": [
        "devbox run install",
        "cd ios && pod install --repo-update",
        "cd ios && env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -workspace ReactNativeExample.xcworkspace -scheme ${IOS_APP_SCHEME} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath ${DEVBOX_PROJECT_ROOT}/.devbox/virtenv/ios/DerivedData -quiet build"
      ],
      "build:web": [
        "devbox run install",
        "node -e \"const path = 'web/build'; require('fs').mkdirSync(path, { recursive: true });\""
      ],
      "build": [
        "devbox run build:android",
        "devbox run build:ios",
        "devbox run build:web"
      ],
      "start:android": [
        "process-compose -f tests/dev-android.yaml --tui=${DEVBOX_TUI:-false}"
      ],
      "start:ios": [
        "process-compose -f tests/dev-ios.yaml --tui=${DEVBOX_TUI:-false}"
      ],
      "start:web": [
        "process-compose -f tests/dev-web.yaml --tui=${DEVBOX_TUI:-false}"
      ],
      "start:metro": [
        "metro.sh start ${1:-default}"
      ],
      "stop:metro": [
        "metro.sh stop ${1:-default}"
      ],
      "start:sim": [
        "ios.sh simulator start ${1:-${IOS_DEFAULT_DEVICE:-max}}"
      ],
      "stop:sim": [
        "ios.sh simulator stop"
      ],
      "start:emu": [
        "android.sh emulator start ${1:-${ANDROID_DEFAULT_DEVICE:-max}}"
      ],
      "stop:emu": [
        "android.sh emulator stop"
      ],
      "test": [
        "npm test"
      ],
      "test:e2e": [
        "bash tests/run-android-tests.sh && bash tests/run-ios-tests.sh"
      ],
      "test:e2e:android": [
        "bash tests/run-android-tests.sh"
      ],
      "test:e2e:ios": [
        "bash tests/run-ios-tests.sh"
      ],
      "test:e2e:all": [
        "bash tests/run-android-tests.sh && bash tests/run-ios-tests.sh"
      ],
      "test:e2e:web": [
        "bash -c \"ANDROID_SKIP_DOWNLOADS=1 IOS_SKIP_SETUP=1 devbox run --pure bash -c 'process-compose -f tests/test-suite-web-e2e.yaml --no-server --tui=${TEST_TUI:-false}'\""
      ]
    }
  }
}
