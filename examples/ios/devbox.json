{
  "include": ["path:../../plugins/ios/plugin.json"],
  "packages": {
    "process-compose": "latest"
  },
  "env": {
    "IOS_APP_PROJECT": "ios.xcodeproj",
    "IOS_APP_SCHEME": "ios",
    "IOS_APP_BUNDLE_ID": "com.example.ios",
    "IOS_APP_ARTIFACT": ".devbox/virtenv/ios/DerivedData/Build/Products/Debug-iphonesimulator/ios.app"
  },
  "shell": {
    "scripts": {
      "build": [
        "echo 'Building iOS app...'",
        "env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT} -scheme ${IOS_APP_SCHEME} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath .devbox/virtenv/ios/DerivedData build"
      ],
      "start:sim": [
        "ios.sh simulator start ${1:-${IOS_DEFAULT_DEVICE:-max}}"
      ],
      "stop:sim": [
        "ios.sh simulator stop"
      ],
      "start:ios": [
        "ios.sh simulator start ${1:-${IOS_DEFAULT_DEVICE:-max}}",
        "xcrun simctl install booted ${IOS_APP_ARTIFACT}",
        "xcrun simctl launch booted ${IOS_APP_BUNDLE_ID}"
      ],
      "deploy": [
        "devbox run build",
        "devbox run start:ios"
      ],
      "test": [
        "env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT} -scheme ${IOS_APP_SCHEME} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath .devbox/virtenv/ios/DerivedData test"
      ],
      "test:e2e": [
        "process-compose -f tests/test-suite.yaml --no-server --tui=${TEST_TUI:-false}"
      ]
    }
  }
}
