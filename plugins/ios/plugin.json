{
  "name": "ios",
  "version": "0.0.1",
  "description": "Configures iOS tooling inside Devbox and ensures Xcode toolchain usage.",
  "env": {
    "IOS_CONFIG_DIR": "{{ .DevboxDir }}",
    "IOS_DEVICES_DIR": "{{ .DevboxDir }}/devices",
    "IOS_DEVICES": "",
    "IOS_SCRIPTS_DIR": "{{ .Virtenv }}/scripts",
    "IOS_DEFAULT_DEVICE": "max",
    "IOS_DEFAULT_RUNTIME": "",
    "IOS_DEVELOPER_DIR": "",
    "IOS_DOWNLOAD_RUNTIME": "1",
    "IOS_XCODE_ENV_PATH": "",
    "REPORTS_DIR": "reports"
  },
  "packages": {
    "bash": "latest",
    "coreutils": "latest",
    "gnused": "latest",
    "gnugrep": "latest",
    "gawk": "latest",
    "jq": "latest",
    "process-compose": "latest",
    "cocoapods": {
      "version": "latest",
      "platforms": ["x86_64-darwin", "aarch64-darwin"]
    }
  },
  "create_files": {
    "{{ .Virtenv }}/scripts/lib/lib.sh": "virtenv/scripts/lib/lib.sh",
    "{{ .Virtenv }}/scripts/platform/core.sh": "virtenv/scripts/platform/core.sh",
    "{{ .Virtenv }}/scripts/platform/device_config.sh": "virtenv/scripts/platform/device_config.sh",
    "{{ .Virtenv }}/scripts/domain/device_manager.sh": "virtenv/scripts/domain/device_manager.sh",
    "{{ .Virtenv }}/scripts/domain/validate.sh": "virtenv/scripts/domain/validate.sh",
    "{{ .Virtenv }}/scripts/domain/simulator.sh": "virtenv/scripts/domain/simulator.sh",
    "{{ .Virtenv }}/scripts/domain/deploy.sh": "virtenv/scripts/domain/deploy.sh",
    "{{ .Virtenv }}/scripts/user/config.sh": "virtenv/scripts/user/config.sh",
    "{{ .Virtenv }}/scripts/user/ios.sh": "virtenv/scripts/user/ios.sh",
    "{{ .Virtenv }}/scripts/user/devices.sh": "virtenv/scripts/user/devices.sh",
    "{{ .Virtenv }}/scripts/init/init-hook.sh": "virtenv/scripts/init/init-hook.sh",
    "{{ .Virtenv }}/scripts/init/setup.sh": "virtenv/scripts/init/setup.sh",
    "{{ .DevboxDir }}/devices/min.json": "config/devices/min.json",
    "{{ .DevboxDir }}/devices/max.json": "config/devices/max.json"
  },
  "shell": {
    "init_hook": [
      "bash {{ .Virtenv }}/scripts/init/init-hook.sh 2>/dev/null || true",
      ". {{ .Virtenv }}/scripts/init/setup.sh"
    ],
    "scripts": {
      "ios:devices:eval": [
        "ios.sh devices eval"
      ],
      "start:sim": [
        "bash -c '. {{ .Virtenv }}/scripts/lib/lib.sh && . {{ .Virtenv }}/scripts/platform/core.sh && . {{ .Virtenv }}/scripts/domain/simulator.sh && ios_start \"${1:-}\"'"
      ],
      "stop:sim": [
        "bash -c '. {{ .Virtenv }}/scripts/lib/lib.sh && . {{ .Virtenv }}/scripts/platform/core.sh && . {{ .Virtenv }}/scripts/domain/simulator.sh && ios_stop'"
      ],
      "doctor": [
        "echo 'iOS Environment Check'",
        "echo '===================='",
        "echo ''",
        "echo 'IOS_DEVELOPER_DIR:' ${IOS_DEVELOPER_DIR:-'NOT SET (using xcode-select)'}",
        "xcrun --show-sdk-path >/dev/null 2>&1 && echo '✓ Xcode command line tools available' || echo '✗ Xcode command line tools not found'",
        "echo ''",
        "command -v xcrun >/dev/null 2>&1 && echo '✓ xcrun is in PATH' || echo '✗ xcrun is not in PATH'",
        "command -v simctl >/dev/null 2>&1 && echo '✓ simctl is available' || echo '⚠ simctl not in PATH (use xcrun simctl)'",
        "xcrun simctl list devices >/dev/null 2>&1 && echo '✓ xcrun simctl working' || echo '✗ xcrun simctl not working'",
        "echo ''",
        "echo 'Device Definitions:'",
        "ls -1 ${IOS_DEVICES_DIR}/*.json 2>/dev/null | wc -l | xargs echo '  Count:'",
        "echo '  IOS_DEVICES:' ${IOS_DEVICES:-'(all devices)'}",
        "echo ''",
        "test -f ${IOS_DEVICES_DIR}/devices.lock && echo '✓ Lock file exists' || echo '⚠ Lock file not generated yet (run devbox shell)'",
        "echo ''"
      ],
      "verify:setup": [
        "xcrun --show-sdk-path >/dev/null 2>&1 && xcrun simctl list devices >/dev/null 2>&1 && echo '✓ iOS environment OK' || (echo '✗ iOS environment check failed. Run: devbox run doctor' && exit 1)"
      ]
    }
  }
}
