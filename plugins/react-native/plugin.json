{
  "name": "react-native",
  "version": "0.0.1",
  "description": "Aggregates the Android and iOS Devbox plugins for React Native projects.",
  "include": [
    "path:../android/plugin.json",
    "path:../ios/plugin.json"
  ],
  "packages": {
    "nodejs": "20",
    "watchman": "latest",
    "process-compose": "latest"
  },
  "env": {
    "REACT_NATIVE_CONFIG_DIR": "{{ .DevboxDir }}",
    "REACT_NATIVE_VIRTENV": "{{ .Virtenv }}",
    "REACT_NATIVE_SCRIPTS_DIR": "{{ .Virtenv }}/scripts",
    "REACT_NATIVE_WEB_BUILD_PATH": "web/build",
    "METRO_CACHE_DIR": "{{ .Virtenv }}/metro/cache",
    "RN_METRO_PORT_START": "8091",
    "RN_METRO_PORT_END": "8199",
    "ANDROID_DEVICES": "",
    "IOS_DEVICES": "",
    "ANDROID_COMPILE_SDK": "35",
    "ANDROID_TARGET_SDK": "35",
    "ANDROID_BUILD_TOOLS_VERSION": "35.0.0",
    "ANDROID_INCLUDE_NDK": "true",
    "ANDROID_NDK_VERSION": "29.0.14206865",
    "ANDROID_INCLUDE_CMAKE": "true",
    "ANDROID_CMAKE_VERSION": "4.1.2"
  },
  "create_files": {
    "{{ .Virtenv }}/metro": "",
    "{{ .Virtenv }}/scripts/lib/lib.sh": "virtenv/scripts/lib/lib.sh",
    "{{ .Virtenv }}/scripts/user/rn.sh": "virtenv/scripts/user/rn.sh"
  },
  "shell": {
    "init_hook": [
      "export NODE_BINARY=\"$(command -v node)\""
    ],
    "scripts": {
      "rn:metro:port": [
        "rn.sh metro port ${1:-default}"
      ],
      "rn:metro:clean": [
        "rn.sh metro clean ${1:-default}"
      ],
      "doctor": [
        "echo 'React Native Environment Check'",
        "echo '=============================='",
        "echo ''",
        "command -v node >/dev/null 2>&1 && echo '✓ Node.js is available' || echo '✗ Node.js not found'",
        "command -v npm >/dev/null 2>&1 && echo '✓ npm is available' || echo '✗ npm not found'",
        "command -v watchman >/dev/null 2>&1 && echo '✓ Watchman is available' || echo '⚠ Watchman not found (recommended for React Native)'",
        "echo ''",
        "echo '--- Android ---'",
        "test -n \"${ANDROID_SDK_ROOT}\" && echo '✓ ANDROID_SDK_ROOT is set' || echo '✗ ANDROID_SDK_ROOT is not set'",
        "test -d \"${ANDROID_SDK_ROOT}\" && echo '✓ ANDROID_SDK_ROOT directory exists' || echo '✗ ANDROID_SDK_ROOT directory does not exist'",
        "command -v adb >/dev/null 2>&1 && echo '✓ adb is in PATH' || echo '✗ adb is not in PATH'",
        "command -v emulator >/dev/null 2>&1 && echo '✓ emulator is in PATH' || echo '✗ emulator is not in PATH'",
        "ls -1 ${ANDROID_DEVICES_DIR}/*.json 2>/dev/null | wc -l | xargs echo '  Device count:'",
        "echo ''",
        "echo '--- iOS ---'",
        "xcrun --show-sdk-path >/dev/null 2>&1 && echo '✓ Xcode command line tools available' || echo '✗ Xcode command line tools not found'",
        "command -v xcrun >/dev/null 2>&1 && echo '✓ xcrun is in PATH' || echo '✗ xcrun is not in PATH'",
        "xcrun simctl list devices >/dev/null 2>&1 && echo '✓ xcrun simctl working' || echo '✗ xcrun simctl not working'",
        "ls -1 ${IOS_DEVICES_DIR}/*.json 2>/dev/null | wc -l | xargs echo '  Device count:'"
      ],
      "verify:setup": [
        "echo 'Verifying React Native setup...'",
        "command -v node >/dev/null 2>&1 && command -v npm >/dev/null 2>&1 || (echo '✗ Node.js/npm check failed' && exit 1)",
        "test -n \"${ANDROID_SDK_ROOT}\" && test -d \"${ANDROID_SDK_ROOT}\" && command -v adb >/dev/null 2>&1 || (echo '✗ Android environment check failed' && exit 1)",
        "xcrun --show-sdk-path >/dev/null 2>&1 && xcrun simctl list devices >/dev/null 2>&1 || (echo '✗ iOS environment check failed' && exit 1)",
        "echo '✓ React Native environment OK'"
      ]
    }
  }
}
