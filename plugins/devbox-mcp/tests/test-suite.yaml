version: "0.5"

log_location: "test-results/devbox-mcp-logs"
log_level: info

processes:
  # Test server structure and configuration
  test-server:
    command: "bash plugins/devbox-mcp/tests/test-server.sh"
    availability:
      restart: "no"

  # Test tool definitions and handlers
  test-tools:
    command: "bash plugins/devbox-mcp/tests/test-tools.sh"
    depends_on:
      test-server:
        condition: process_completed_successfully
    availability:
      restart: "no"

  # Test MCP tools functionality
  test-mcp-tools:
    command: "node plugins/devbox-mcp/tests/test-mcp-tools.js"
    depends_on:
      test-tools:
        condition: process_completed_successfully
    availability:
      restart: "no"

  # Summary process - displays test results
  summary:
    command: |
      echo ""
      echo "===================================="
      echo "Devbox MCP Test Suite Summary"
      echo "===================================="
      echo ""
      echo "Test Logs:"
      echo "  test-results/devbox-mcp-logs"
      echo ""
      echo "All tests completed!"
      echo "===================================="

      # In TUI mode, delay 30 seconds so user can view summary before exit
      if [ "${TEST_TUI:-false}" = "true" ] || [ "${TEST_TUI:-false}" = "1" ]; then
        echo ""
        echo "TUI mode: Waiting 30 seconds before exit (Ctrl+C to exit now)..."
        sleep 30
      fi
    depends_on:
      test-server:
        condition: process_completed
      test-tools:
        condition: process_completed
      test-mcp-tools:
        condition: process_completed
    availability:
      restart: "no"
    shutdown:
      signal: 15
      timeout_seconds: 1
