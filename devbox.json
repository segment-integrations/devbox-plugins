{
  "packages": {
    "process-compose": "latest",
    "act": "latest",
    "shellcheck": "latest",
    "nodejs": "latest",
    "treefmt": "latest"
  },
  "env": {
    "REPORTS_DIR": "reports",
    "TEST_RESULTS_DIR": "reports/results",
    "TEST_LOGS_DIR": "reports/logs",
    "TEST_TUI": "false"
  },
  "shell": {
    "scripts": {
      "lint": [
        "echo 'Running linting and validation...'",
        "treefmt --fail-on-change"
      ],
      "test:android": [
        "echo 'Running Android plugin tests...'",
        "cd examples/android && devbox run test"
      ],
      "test:ios:lib": [
        "sh plugins/tests/ios/test-lib.sh"
      ],
      "test:ios": [
        "devbox run test:plugin:ios",
        "devbox run test:integration:ios"
      ],
      "test:unit": [
        "echo 'Running orchestrated unit tests...'",
        "process-compose -f tests/process-compose-unit-tests.yaml --tui=${TEST_TUI:-false}"
      ],
      "test:e2e:android": [
        "echo 'Running Android example E2E test...'",
        "cd examples/android && devbox run test:e2e"
      ],
      "test:e2e:ios": [
        "echo 'Running iOS example E2E test...'",
        "cd examples/ios && devbox run test:e2e"
      ],
      "test:e2e:rn": [
        "echo 'Running React Native example E2E test...'",
        "cd examples/react-native && devbox run test:e2e"
      ],
      "test:e2e": [
        "echo 'Running E2E tests (orchestrated: android+ios parallel, then rn)...'",
        "process-compose -f tests/process-compose-e2e.yaml --no-server --tui=${TEST_TUI:-false}"
      ],
      "test": [
        "echo '========================================'",
        "echo 'Running ALL tests (fast + e2e)'",
        "echo '========================================'",
        "echo ''",
        "devbox run test:fast",
        "echo ''",
        "echo '========================================'",
        "echo 'Running E2E tests...'",
        "echo '========================================'",
        "devbox run test:e2e"
      ],
      "format": [
        "echo 'Running treefmt (validates shell scripts, workflows, and process-compose configs)...'",
        "treefmt"
      ],
      "format:check": [
        "echo 'Checking formatting with treefmt...'",
        "treefmt --fail-on-change"
      ],
      "sync": [
        "echo 'Syncing example projects with latest plugins...'",
        "echo ''",
        "echo '1/3 Android...'",
        "(cd examples/android && rm -rf .devbox devbox.d devbox.lock && devbox install)",
        "echo '    Generating device lock file...'",
        "(cd examples/android && ANDROID_DEVICES_EVAL=1 devbox run android:devices:eval > /dev/null)",
        "echo '  ✓ Android synced'",
        "echo ''",
        "echo '2/3 iOS...'",
        "(cd examples/ios && rm -rf .devbox devbox.d devbox.lock && devbox install)",
        "echo '    Generating device lock file...'",
        "(cd examples/ios && IOS_DEVICES_EVAL=1 devbox run ios:devices:eval > /dev/null)",
        "echo '  ✓ iOS synced'",
        "echo ''",
        "echo '3/3 React Native...'",
        "(cd examples/react-native && rm -rf .devbox devbox.d devbox.lock && devbox install)",
        "echo '    Generating Android lock file...'",
        "(cd examples/react-native && ANDROID_DEVICES_EVAL=1 devbox run android:devices:eval > /dev/null)",
        "echo '    Generating iOS lock file...'",
        "(cd examples/react-native && IOS_DEVICES_EVAL=1 devbox run ios:devices:eval > /dev/null)",
        "echo '  ✓ React Native synced'",
        "echo ''",
        "echo '✓ All examples synced successfully!'",
        "echo ''",
        "echo 'Note: AVDs and simulators will be created automatically on first emulator/simulator start.'"
      ],
      "test:plugin:android:lib": [
        "bash plugins/tests/android/test-lib.sh"
      ],
      "test:plugin:android:devices": [
        "bash plugins/tests/android/test-devices.sh"
      ],
      "test:plugin:android:emulator-detection": [
        "(cd examples/android && devbox run bash ../../plugins/tests/android/test-emulator-detection.sh)"
      ],
      "test:plugin:android:emulator-modes": [
        "(cd examples/android && devbox run bash ../../plugins/tests/android/test-emulator-modes.sh)"
      ],
      "test:plugin:android": [
        "devbox run test:plugin:android:lib",
        "devbox run test:plugin:android:devices"
      ],
      "test:plugin:android:all": [
        "echo 'Running all Android plugin tests (including emulator tests)...'",
        "devbox run test:plugin:android:lib",
        "devbox run test:plugin:android:devices",
        "devbox run test:plugin:android:emulator-detection",
        "devbox run test:plugin:android:emulator-modes"
      ],
      "test:plugin:ios:lib": [
        "sh plugins/tests/ios/test-lib.sh"
      ],
      "test:plugin:ios:devices": [
        "sh plugins/tests/ios/test-devices.sh"
      ],
      "test:plugin:ios": [
        "devbox run test:plugin:ios:lib",
        "devbox run test:plugin:ios:devices"
      ],
      "test:plugin:devbox-mcp": [
        "echo 'Running devbox-mcp plugin tests...'",
        "process-compose -f plugins/devbox-mcp/tests/test-suite.yaml --no-server --tui=${TEST_TUI:-false}"
      ],
      "test:plugin:devbox-mcp:watch": [
        "echo 'Running devbox-mcp plugin tests (interactive mode)...'",
        "TEST_TUI=true process-compose -f plugins/devbox-mcp/tests/test-suite.yaml"
      ],
      "test:plugin:unit": [
        "echo 'Running plugin unit tests...'",
        "devbox run test:plugin:android",
        "devbox run test:plugin:ios",
        "devbox run test:plugin:devbox-mcp"
      ],
      "test:integration:android:device-mgmt": [
        "/bin/bash tests/integration/android/test-device-mgmt.sh"
      ],
      "test:integration:android:validation": [
        "/bin/bash tests/integration/android/test-validation.sh"
      ],
      "test:integration:android": [
        "/bin/bash tests/integration/android/test-device-mgmt.sh",
        "/bin/bash tests/integration/android/test-validation.sh"
      ],
      "test:integration:ios:device-mgmt": [
        "/bin/bash tests/integration/ios/test-device-mgmt.sh"
      ],
      "test:integration:ios:cache": [
        "/bin/bash tests/integration/ios/test-cache.sh"
      ],
      "test:integration:ios": [
        "/bin/bash tests/integration/ios/test-device-mgmt.sh",
        "/bin/bash tests/integration/ios/test-cache.sh"
      ],
      "test:integration": [
        "echo 'Running integration tests...'",
        "/bin/bash tests/integration/android/test-device-mgmt.sh",
        "/bin/bash tests/integration/android/test-validation.sh",
        "/bin/bash tests/integration/ios/test-device-mgmt.sh",
        "/bin/bash tests/integration/ios/test-cache.sh"
      ],
      "test:fast": [
        "echo 'Running fast tests (lint + unit + integration)...'",
        "devbox run lint",
        "devbox run test:plugin:unit",
        "devbox run test:integration",
        "bash tests/test-summary.sh"
      ]
    }
  }
}
